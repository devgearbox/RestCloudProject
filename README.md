# 🚀 荔枝批发管理系统 - 微服务架构重构版

## 📖 项目概述

本项目是**荔枝批发管理系统**的微服务架构重构版本，旨在通过分布式系统设计，将原单体应用解耦为独立的微服务，提升系统的可维护性、可扩展性和容错能力。作为学习项目，重点在于实践微服务架构的核心概念与技术栈。

> **学习宣言**：本项目是我从单体架构向微服务架构转型的实践作品，记录了我对分布式系统、服务治理、服务间通信等核心概念的探索过程。虽然还在学习完善中，但已初步完成了服务拆分、独立部署和基础通信功能。

## 🏗️ 架构演进

### 架构对比

| 维度 | 单体架构 | 微服务架构 |
|:---|:---|:---|
| **部署方式** | 单应用部署 | 服务独立部署 |
| **技术栈** | 统一技术栈 | 可按服务选择 |
| **数据库** | 单一数据库 | 独立数据库 |
| **通信方式** | 方法调用 | HTTP/RPC |
| **容错性** | 单点故障 | 服务隔离 |
| **学习难度** | 相对简单 | 复杂度较高 |

### 当前架构设计
```bash
┌─────────────────────────────────────────────────────────┐
│ API Gateway (Spring Cloud Gateway) │
└───────────────────────────┬─────────────────────────────┘
│
┌────────────────────┼────────────────────┐
│ │ │
▼ ▼ ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ User Service│ │ Order Service│ │ Stock Service │
│ (已完成) │ │ (开发中) │ │ (待开发) │
└─────────────┘ └─────────────┘ └─────────────┘
│ │ │
└────────────────────┼────────────────────┘
│
┌──────────▼──────────┐
│ Service Registry │
│ (Nacos/Eureka) │
└─────────────────────┘
```


## 📁 项目结构（微服务版）
```bash
lizhi-cloud/
├── docs/ # 项目文档
├── libs/ # 公共库模块
│ ├── common-core/ # 核心公共模块
│ │ ├── src/main/java
│ │ │ ├── constant/ # 常量定义
│ │ │ ├── exception/ # 通用异常
│ │ │ ├── utils/ # 工具类
│ │ │ └── CommonCoreApplication.java
│ │ └── pom.xml
│ └── common-security/ # 安全公共模块
│ ├── src/main/java
│ │ ├── config/ # 安全配置
│ │ ├── filter/ # 过滤器
│ │ └── util/ # 安全工具
│ └── pom.xml
├── lizhi-gateway/ # API网关服务
│ ├── src/main/java
│ │ ├── filter/ # 网关过滤器
│ │ ├── route/ # 路由配置
│ │ └── GatewayApplication.java
│ └── pom.xml
├── lizhi-user-service/ # 用户服务（已完成）
│ ├── user-api/ # 用户服务API模块
│ │ ├── src/main/java
│ │ │ ├── dto/ # 数据传输对象
│ │ │ │ ├── UserDTO.java
│ │ │ │ ├── LoginRequest.java
│ │ │ │ └── LoginResponse.java
│ │ │ ├── feign/ # Feign客户端接口
│ │ │ │ └── OrderFeignClient.java
│ │ │ ├── request/ # 请求对象
│ │ │ └── response/ # 响应对象
│ │ └── pom.xml
│ └── user-impl/ # 用户服务实现模块
│ ├── src/main/java/org/example/
│ │ ├── controller/ # 控制器层
│ │ │ ├── UserController.java
│ │ │ └── AuthController.java
│ │ ├── service/ # 业务层
│ │ ├── repository/ # 数据访问层
│ │ └── UserServiceApplication.java
│ ├── src/main/resources/
│ │ ├── application.yml # 独立配置文件
│ │ └── bootstrap.yml # Nacos配置
│ └── pom.xml
├── lizhi-order-service/ # 订单服务（今日重点）
│ ├── order-api/ # 订单API模块（待创建）
│ └── order-impl/ # 订单实现模块（待创建）
├── .gitignore
└── pom.xml # 父模块管理
```


## 🛠️ 技术栈（微服务版）

### 核心框架
- **Spring Boot 3.2.2**：微服务基础框架
- **Spring Cloud 2023.0.0**：微服务全家桶
- **Spring Cloud Alibaba**：阿里微服务解决方案

### 服务治理
- **Nacos 2.3.0**：服务注册与配置中心（已实现）
- **Spring Cloud Gateway**：API网关（已搭建）
- **OpenFeign**：声明式HTTP客户端（已实现）
- **Spring Cloud LoadBalancer**：客户端负载均衡

### 数据持久化
- **MySQL 8.0+**：关系型数据库（用户服务已独立）
- **MyBatis-Plus**：数据访问层框架
- **Druid**：数据库连接池

### 安全与监控
- **JWT**：无状态认证（用户服务已实现）
- **Spring Security**：安全框架（公共模块）
- **Spring Boot Actuator**：应用监控
- **Prometheus + Grafana**：监控系统（计划中）

## 🚀 已完成功能

### 1. 微服务基础架构 ✅
- [x] **多模块Maven项目结构**：实现项目模块化
- [x] **Nacos服务注册与发现**：完成服务注册中心搭建
- [x] **API网关搭建**：基于Spring Cloud Gateway
- [x] **公共模块抽取**：common-core和common-security

### 2. 用户服务实现 ✅
- [x] **独立数据库设计**：用户服务拥有独立的MySQL数据库
- [x] **JWT认证实现**：基于Token的无状态认证
- [x] **登录接口解耦**：原单体登录功能迁移为独立服务
- [x] **服务注册**：用户服务成功注册到Nacos
- [x] **配置中心集成**：应用配置从Nacos动态获取

### 3. 关键技术验证 ✅
- [x] **服务间调用测试**：通过RestTemplate初步实现
- [x] **配置管理**：实现Nacos动态配置更新
- [x] **独立部署验证**：各服务可独立启动运行

## 🎯 今日学习与开发目标（正在进行）

### 学习重点：OpenFeign与服务间通信
- [ ] **OpenFeign深度理解**：声明式HTTP客户端的工作原理
- [ ] **Feign与RestTemplate对比**：优劣分析与适用场景
- [ ] **服务间调用实践**：用户服务与订单服务的通信
- [ ] **负载均衡集成**：结合Ribbon/Spring Cloud LoadBalancer
- [ ] **容错处理**：服务降级、熔断机制（后续结合Sentinel）

### 订单服务开发计划
- [ ] **订单API模块创建**：定义订单服务的DTO和Feign接口
- [ ] **订单服务实现**：订单CRUD接口开发
- [ ] **数据库设计**：订单服务独立数据库设计
- [ ] **服务间调用**：订单服务通过Feign调用用户服务
- [ ] **业务逻辑实现**：订单创建、查询、状态更新等核心功能

### 权限信息传递方案设计
- [ ] **JWT令牌传递**：网关验证后传递用户信息到下游服务
- [ ] **Feign请求拦截器**：自动添加认证信息到请求头
- [ ] **线程上下文传递**：使用ThreadLocal存储用户上下文
- [ ] **权限注解设计**：自定义注解实现方法级权限控制

## 📚 学习路线与进展

### 已完成学习

- 微服务理论基础：服务拆分原则、分布式系统概念

- Nacos深度使用：服务注册、配置管理、集群搭建、Nacos配置热更新、多环境管理

- Spring Cloud Gateway：路由配置、过滤器链、全局异常处理

- JWT认证方案：Token生成、验证、刷新机制

- 独立数据库设计：数据库垂直拆分策略



### 正在学习

- OpenFeign高级特性：编码器、解码器、拦截器

- 服务间通信模式：同步调用、异步消息、事件驱动

- 分布式事务：Seata框架学习与实践

- 服务监控：链路追踪、指标监控、日志聚合

### 后续计划

- 服务容错：Sentinel流量控制、熔断降级

- 消息队列：RocketMQ/Kafka集成，异步解耦

- 容器化部署：Docker容器化、Kubernetes编排

#### 项目状态：微服务重构进行中
#### 学习阶段：中级微服务实践

### 学习宣言：作为大四实习生，我深知自己在分布式系统领域还有很长的路要走。这个项目是我学习微服务的实践记录，每一步都伴随着查阅文档、调试错误和总结思考。我享受这种从0到1的构建过程，也期待在实习岗位上得到更多实战指导。
